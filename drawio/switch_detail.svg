<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1172px" height="1521px" viewBox="-0.5 -0.5 1172 1521" content="&lt;mxfile&gt;&lt;diagram id=&quot;etOpSMWFl5M_kmi4hWZi&quot; name=&quot;Page-1&quot;&gt;7ZpJb+M2FMc/DYGZQwZaqO1oOZ7ppUWBHHo0aImWhUiiS8mxM5++jxJla6HjYKolTR0EMPW4P/70J/lsZC7T0w9O9rvfWUgTZGjhCZmPyDB0x9HgQ1heK4tjepUh4nEoC10MT/FPKo2yXnSIQ5q3ChaMJUW8bxsDlmU0KFo2wjk7tottWdLudU8i2jM8BSTpW/+Kw2JXWV1Lu9h/o3G0q3vWNZmTkrqwNOQ7ErJjw2SukLnkjBVVKj0taSKcV/ulqvf9Su55YJxmxXsqGNLxLyQ5yMnJgRWv9WxpCJOXjxnL4MPfFWkCTzok+z3KQeTswAPZhOHIVSI8orKY4VY20XyjohznD8pSWvBXKMBpQor4pe17IpcwOpe7zBIScqJXJu30J73CyPfF/8pC7gItdLSykQ9pveePxuRDku+oaFWDh+MuLmi+J+Wkj0A+2GB99+IxPUXiVfgWbsNvOXihuOq2F8oLenrTITLXwBIi+Ra58vHYQFKadg0aTe3fe9A0p8HG7WNjGrNh4yqwcZCH0cIVtLgu8h3Bj68jV0kUFPiOPE0k4NFd9nzG2SELS6D0GqinNlDX4BuCJ6PNk64ASjcURNlDENV/zwYAqGZ9OFhk1T9ZDN1eXOe2XWc4VruJimBZq+OV8zDe5yhNQaGFFivkLQSFnoN8W1g8r+QSKATaHsssWyS6bgY6irZrSRJHGaQDcC3lYBAMxbD9LWRGGoehqO5zmsc/yaZsSlC4FxMsp2z5yHoUbR0KllcbuGg6Lzh7pkuWMH5Z1W2cJB3TADjrVmdN7An10ZpEH2stbOkjnksf69F0yARZdJ1SHx/RQimLJaKQlglfsgq1DDsRbG44pCKRUjVYWnytHAl4ExTq6tb9ofTVNKbUV8XmNQaRWEGkMxuRWEFkyYprlhs18NfUSkDKQ/6qgVSfvzOjVUKrFXahIPtD4Ydnxc/urcTNl/WzbkzYsNobk9dfCHukjQkrNHoMGVDc97A+mwyo7nsTbkyfRzOw4gw1nmaoYhOV38P4peUl+++DiJj4QfWyLgRF0eaLocEGAP1ozcTX0jXahgTPUench04tcRURZS+fssqWZcXDlqRx8lqVXrIsZwnMsSwHwyCpWBA5mCW8EDHIlKH9QY/dzKpKyjImIwbnDo7SjaKDjPGUJI3MSrFElo73pyojiTP6sGvU0j2ZZZ87k5A23dc2wSiyWy5FhhmUf9car2aYbfJ9o2VY5qrxX+owDMKAEGWH63V+jItgN0xHb8zsyzA9eDCVLVX2IPbCdVCcRp/KmdRx55PB1i3ms94XfPQ5fb3RA5gVwHet6sPHDb0dQGLNzjXVUhzLzieEpsTiIY4DimDCXWLnldj/h+IFBy5emslEYiLhm0zI/9uip3euQKYi1GxqY4me3he9zxzHn/TQjs0x7pN48KDm++L4ljVaHB+rYlP3OP7tOL6F+ziPFcfH08TxsYyOtcIls309jvuxunsc/w19tbUp9VURyxqDSMU379ZsATys+ub9HsefA79+TO4ex683Jqe/EGPF8es9cWQZqF/5lgwYc8mApTq43+P4v6AZjuIMNZpmWIrzxBisGgpWrdlYNXqT5odsXZD8+WOh0T3NTIuG4hI0EBqTXxWNjj8qNntXxZsNnffz4e+cluI6c9EyB3kgYRitPCF/oH3iOorLxFlAPeRVmliGQIRKOuLE5fZjSR8KanfEnzLC4+X32tWiXH71bq7+AQ==&lt;/diagram&gt;&lt;diagram id=&quot;yhtAG_KMgS4wdQqBAH3Q&quot; name=&quot;Page-2&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><path d="M 235 90 L 235 163.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 235 168.88 L 231.5 161.88 L 235 163.63 L 238.5 161.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="175" y="30" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 60px; margin-left: 176px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">任务1</div></div></div></foreignObject><text x="235" y="64" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">任务1</text></switch></g><rect x="190" y="0" width="90" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 15px; margin-left: 235px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">任务1控制流</div></div></div></foreignObject><text x="235" y="19" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">任务1控制流</text></switch></g><path d="M 235 230 L 235 303.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 235 308.88 L 231.5 301.88 L 235 303.63 L 238.5 301.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="175" y="170" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 176px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">保存上下文</div></div></div></foreignObject><text x="235" y="204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">保存上下文</text></switch></g><rect x="130" y="115" width="110" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 135px; margin-left: 185px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">定时器中段触发<br />进入内核</div></div></div></foreignObject><text x="185" y="139" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">定时器中段触发
进入内核</text></switch></g><path d="M 235 370 L 235 443.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 235 448.88 L 231.5 441.88 L 235 443.63 L 238.5 441.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="175" y="310" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 340px; margin-left: 176px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">在 trap handler 中<br />由于是定时器中断<br />执行 back_to_idle()</div></div></div></foreignObject><text x="235" y="344" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">在 trap handler 中...</text></switch></g><rect x="0" y="450" width="470" height="200" rx="30" ry="30" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 468px; height: 1px; padding-top: 550px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div style="color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px;"><div>    <span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">back_to_idle</span>(<span style="color: #d4d4d4;">&amp;</span><span style="color: #569cd6;">self</span>) {</div><div>        <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">inner</span> <span style="color: #d4d4d4;">=</span> <span style="color: #569cd6;">self</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">inner_access</span>();</div><div>        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">idle_ctx</span> <span style="color: #d4d4d4;">=</span> <span style="color: #9cdcfe;">inner</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">idle_ctx</span>();</div><div>        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">current</span> <span style="color: #d4d4d4;">=</span> <span style="color: #9cdcfe;">inner</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">current_task</span>(<span style="color: #569cd6;">false</span>)<span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">unwrap</span>();</div><div>        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">current_ctx_ptr</span> <span style="color: #d4d4d4;">=</span> <span style="color: #9cdcfe;">current</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span>()<span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">ctx_ptr</span>();</div><div>        <span style="color: #dcdcaa;">drop</span>(<span style="color: #9cdcfe;">current</span>);</div><div>        <span style="color: #dcdcaa;">drop</span>(<span style="color: #9cdcfe;">inner</span>);</div><div>        <span style="color: #569cd6;">unsafe</span> { <span style="color: #dcdcaa;">__switch</span>(<span style="color: #9cdcfe;">current_ctx_ptr</span>, <span style="color: #9cdcfe;">idle_ctx</span>); }</div><div>    }</div></div></div></div></div></foreignObject><text x="2" y="554" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">pub fn back_to_idle(&amp;self) {...</text></switch></g><path d="M 424.88 610 L 698.63 610" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 703.88 610 L 696.88 613.5 L 698.63 610 L 696.88 606.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="470" y="530" width="140" height="70" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 565px; margin-left: 540px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">执行 switch 时切换，<br />所以这个 back_to_idle<br /> 函数没有执行完，<br />在返回前暂停了</div></div></div></foreignObject><text x="540" y="569" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">执行 switch 时切换，...</text></switch></g><path d="M 765 90 L 765 123.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 765 128.88 L 761.5 121.88 L 765 123.63 L 768.5 121.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="705" y="30" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 60px; margin-left: 706px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">IDLE 控制流</div></div></div></foreignObject><text x="765" y="64" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">IDLE 控制流</text></switch></g><path d="M 765 190 L 765 233.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 765 238.88 L 761.5 231.88 L 765 233.63 L 768.5 231.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="705" y="130" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 160px; margin-left: 706px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">执行 run_task 函数，这是一个不会退出的 loop 函数</div></div></div></foreignObject><text x="765" y="164" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">执行 run_task 函数，这是一个不会退出的 loop 函数</text></switch></g><path d="M 765 300 L 765 353.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 765 358.88 L 761.5 351.88 L 765 353.63 L 768.5 351.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="705" y="240" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 270px; margin-left: 706px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">执行 run_task 函数，这是一个不会退出的 loop 函数</div></div></div></foreignObject><text x="765" y="274" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">执行 run_task 函数，这是一个不会退出的 loop 函数</text></switch></g><path d="M 765 640 L 765 713.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 765 718.88 L 761.5 711.88 L 765 713.63 L 768.5 711.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="705" y="580" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 610px; margin-left: 706px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">切换回 idle，接着运行 run_task 函数</div></div></div></foreignObject><text x="765" y="614" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">切换回 idle，接着运行 run_task 函数</text></switch></g><path d="M 765 460 L 765 573.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="8 8" pointer-events="stroke"/><path d="M 765 578.88 L 761.5 571.88 L 765 573.63 L 768.5 571.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="600" y="360" width="330" height="100" rx="15" ry="15" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 328px; height: 1px; padding-top: 410px; margin-left: 601px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">在其中执行<br /><div style="color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px;"><span style="color: #dcdcaa;">__switch</span>(<span style="color: #9cdcfe;">idle_ctx</span>, <span style="color: #9cdcfe;">next_ctx_ptr</span>)<br />切换出去了，此时 idle_ctx 停留在这句话后面</div></div></div></div></foreignObject><text x="765" y="414" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">在其中执行__switch(idle_ctx, next_ctx_ptr)...</text></switch></g><rect x="595" y="490" width="170" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 510px; margin-left: 680px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">等待控制流切换回 idle<br />可以在 run_task 中接着执行</div></div></div></foreignObject><text x="680" y="514" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">等待控制流切换回 idle...</text></switch></g><path d="M 765 780 L 765 853.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 765 858.88 L 761.5 851.88 L 765 853.63 L 768.5 851.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="705" y="720" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 750px; margin-left: 706px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">loop 回到循环语句开始，继续寻找下一个要切换的任务</div></div></div></foreignObject><text x="765" y="754" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">loop 回到循环语句开始，继续寻找下一个要切换的任务</text></switch></g><path d="M 705 890 L 651.31 908.21" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 646.34 909.89 L 651.84 904.33 L 651.31 908.21 L 654.09 910.96 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 765 920 L 765 993.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 765 998.88 L 761.5 991.88 L 765 993.63 L 768.5 991.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="705" y="860" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 890px; margin-left: 706px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">loop 回到循环语句开始，继续寻找下一个要切换的任务</div></div></div></foreignObject><text x="765" y="894" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">loop 回到循环语句开始，继续寻找下一个要切换的任务</text></switch></g><rect x="120" y="770" width="560" height="750" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 558px; height: 1px; padding-top: 777px; margin-left: 122px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div style="color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &quot;Courier New&quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px;"><div><span style="color: #cccccc;">            </span><span style="color: #c586c0;">match</span><span style="color: #cccccc;"> </span><span style="color: #9cdcfe;">next_status</span><span style="color: #cccccc;"> {</span></div><div><span style="color: #cccccc;">                READY </span><span style="color: #d4d4d4;">=&gt;</span><span style="color: #cccccc;"> </span><span style="color: #569cd6;">unsafe</span><span style="color: #cccccc;"> {</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #569cd6;">let</span><span style="color: #cccccc;"> </span><span style="color: #9cdcfe;">tick</span><span style="color: #cccccc;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #cccccc;"> </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #cccccc;">tick;</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">set_status</span><span style="color: #cccccc;">(RUNNING(</span><span style="color: #9cdcfe;">tick</span><span style="color: #cccccc;">));</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">activate</span><span style="color: #cccccc;">();</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #dcdcaa;">drop</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">next</span><span style="color: #cccccc;">);</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #dcdcaa;">drop</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">inner</span><span style="color: #cccccc;">);</span></div><br /><div><span style="color: #cccccc;">                    </span><span style="color: #569cd6;">unsafe</span><span style="color: #cccccc;"> { </span><span style="color: #dcdcaa;">__switch</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">idle_ctx</span><span style="color: #cccccc;">, </span><span style="color: #9cdcfe;">next_ctx_ptr</span><span style="color: #cccccc;">); }</span></div><div><span style="color: #cccccc;">                },</span></div><div><span style="color: #cccccc;">                RUNNING(</span><span style="color: #9cdcfe;">_</span><span style="color: #cccccc;">) </span><span style="color: #d4d4d4;">=&gt;</span><span style="color: #cccccc;"> </span><span style="color: #569cd6;">unsafe</span><span style="color: #cccccc;"> {</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">set_status</span><span style="color: #cccccc;">(SLEEP(</span><span style="color: #dcdcaa;">nanoseconds</span><span style="color: #cccccc;">(), </span><span style="color: #b5cea8;">0</span><span style="color: #cccccc;">));</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">activate</span><span style="color: #cccccc;">();</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #dcdcaa;">drop</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">next</span><span style="color: #cccccc;">);</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #dcdcaa;">drop</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">inner</span><span style="color: #cccccc;">);</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #569cd6;">unsafe</span><span style="color: #cccccc;"> { </span><span style="color: #dcdcaa;">__switch</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">idle_ctx</span><span style="color: #cccccc;">, </span><span style="color: #9cdcfe;">next_ctx_ptr</span><span style="color: #cccccc;">); }</span></div><div><span style="color: #cccccc;">                }</span></div><div><span style="color: #cccccc;">                SLEEP(</span><span style="color: #9cdcfe;">a</span><span style="color: #cccccc;">, </span><span style="color: #9cdcfe;">b</span><span style="color: #cccccc;">) </span><span style="color: #d4d4d4;">=&gt;</span><span style="color: #cccccc;"> </span><span style="color: #569cd6;">unsafe</span><span style="color: #cccccc;"> {</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #c586c0;">if</span><span style="color: #cccccc;"> </span><span style="color: #9cdcfe;">a</span><span style="color: #cccccc;"> </span><span style="color: #d4d4d4;">+</span><span style="color: #cccccc;"> </span><span style="color: #9cdcfe;">b</span><span style="color: #cccccc;"> </span><span style="color: #d4d4d4;">&lt;</span><span style="color: #cccccc;"> </span><span style="color: #dcdcaa;">nanoseconds</span><span style="color: #cccccc;">() {</span></div><div><span style="color: #cccccc;">                        </span><span style="color: #569cd6;">let</span><span style="color: #cccccc;"> </span><span style="color: #9cdcfe;">tick</span><span style="color: #cccccc;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #cccccc;"> </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #cccccc;">tick;</span></div><div><span style="color: #cccccc;">                        </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">set_status</span><span style="color: #cccccc;">(RUNNING(</span><span style="color: #9cdcfe;">tick</span><span style="color: #cccccc;">));</span></div><div><span style="color: #cccccc;">                        </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">lock</span><span style="color: #cccccc;">()</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">activate</span><span style="color: #cccccc;">();</span></div><div><span style="color: #cccccc;">                        </span><span style="color: #dcdcaa;">drop</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">next</span><span style="color: #cccccc;">);</span></div><div><span style="color: #cccccc;">                        </span><span style="color: #dcdcaa;">drop</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">inner</span><span style="color: #cccccc;">);</span></div><div><span style="color: #cccccc;">                        </span><span style="color: #569cd6;">unsafe</span><span style="color: #cccccc;"> { </span><span style="color: #dcdcaa;">__switch</span><span style="color: #cccccc;">(</span><span style="color: #9cdcfe;">idle_ctx</span><span style="color: #cccccc;">, </span><span style="color: #9cdcfe;">next_ctx_ptr</span><span style="color: #cccccc;">); }</span></div><div><span style="color: #cccccc;">                    } </span><span style="color: #c586c0;">else</span><span style="color: #cccccc;"> {</span></div><div><span style="color: #cccccc;">                        </span><span style="color: #c586c0;">continue</span><span style="color: #cccccc;">;</span></div><div><span style="color: #cccccc;">                    }</span></div><div><span style="color: #cccccc;">                }</span></div><div><span style="color: #cccccc;">                </span><span style="color: #9cdcfe;">_</span><span style="color: #cccccc;"> </span><span style="color: #d4d4d4;">=&gt;</span><span style="color: #cccccc;"> {</span></div><div><span style="color: #cccccc;">                    </span><span style="color: #c586c0;">continue</span><span style="color: #cccccc;">;</span></div><div><span style="color: #cccccc;">                },</span></div><div><span style="color: #cccccc;">            }</span></div></div></div></div></div></foreignObject><text x="122" y="789" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">match next_status {...</text></switch></g><path d="M 825 1030 L 1043.63 1030" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1048.88 1030 L 1041.88 1033.5 L 1043.63 1030 L 1041.88 1026.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="705" y="1000" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1030px; margin-left: 706px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">找到后切换</div></div></div></foreignObject><text x="765" y="1034" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">找到后切换</text></switch></g><path d="M 1110 90 L 1110 163.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1110 168.88 L 1106.5 161.88 L 1110 163.63 L 1113.5 161.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="1050" y="30" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 60px; margin-left: 1051px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">任务2</div></div></div></foreignObject><text x="1110" y="64" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">任务2</text></switch></g><rect x="1065" y="0" width="90" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 15px; margin-left: 1110px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">任务2控制流</div></div></div></foreignObject><text x="1110" y="19" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">任务2控制流</text></switch></g><path d="M 1110 230 L 1110 303.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1110 308.88 L 1106.5 301.88 L 1110 303.63 L 1113.5 301.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="1050" y="170" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 1051px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">保存上下文</div></div></div></foreignObject><text x="1110" y="204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">保存上下文</text></switch></g><rect x="1005" y="115" width="110" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 135px; margin-left: 1060px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">定时器中段触发<br />进入内核</div></div></div></foreignObject><text x="1060" y="139" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">定时器中段触发
进入内核</text></switch></g><path d="M 1110 370 L 1110 443.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1110 448.88 L 1106.5 441.88 L 1110 443.63 L 1113.5 441.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="1050" y="310" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 340px; margin-left: 1051px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">在 trap handler 中<br />由于是定时器中断<br />执行 back_to_idle()</div></div></div></foreignObject><text x="1110" y="344" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">在 trap handler 中...</text></switch></g><path d="M 1110 510 L 1110 993.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 1110 998.88 L 1106.5 991.88 L 1110 993.63 L 1113.5 991.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="1050" y="450" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 480px; margin-left: 1051px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">与任务1一样，在 back to idle 里切换出去了。卡在返回前</div></div></div></foreignObject><text x="1110" y="484" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">与任务1一样，在 back to idle 里切换出去了。卡在返回前</text></switch></g><path d="M 1110 1060 L 1110 1133.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1110 1138.88 L 1106.5 1131.88 L 1110 1133.63 L 1113.5 1131.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="1050" y="1000" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1030px; margin-left: 1051px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">任务1 继续执行<br />完成 back_to_idle()</div></div></div></foreignObject><text x="1110" y="1034" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">任务1 继续执行...</text></switch></g><rect x="845" y="1000" width="190" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1015px; margin-left: 940px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">下一个任务时任务1，切换过去</div></div></div></foreignObject><text x="940" y="1019" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">下一个任务时任务1，切换过去</text></switch></g><path d="M 1110 1200 L 1110 1273.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1110 1278.88 L 1106.5 1271.88 L 1110 1273.63 L 1113.5 1271.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="1050" y="1140" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1170px; margin-left: 1051px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">回到调用 back_to_idle() 的 trap_handler 中继续</div></div></div></foreignObject><text x="1110" y="1174" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">回到调用 back_to_idle() 的 tra...</text></switch></g><rect x="1050" y="1280" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1310px; margin-left: 1051px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">trap_handler 完成，执行 restore 回到了任务1，此时执行任务1</div></div></div></foreignObject><text x="1110" y="1314" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">trap_handler 完成，执行 restor...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>